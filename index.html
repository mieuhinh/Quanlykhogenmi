<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Kho Th√¥ng Minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .active { display: block; }
        .active-nav { color: #2563eb; border-bottom: 3px solid #2563eb; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <nav class="bg-white shadow sticky top-0 flex justify-around text-sm font-bold p-3 z-50">
        <button onclick="showTab('menu')" id="btn-menu" class="active-nav">MENU</button>
        <button onclick="showTab('nhap')" id="btn-nhap">NH·∫¨P</button>
        <button onclick="showTab('xuat')" id="btn-xuat">XU·∫§T</button>
        <button onclick="showTab('baocao')" id="btn-baocao">B√ÅO C√ÅO</button>
    </nav>

    <div class="p-4 mb-20">
        <div id="tab-menu" class="tab-content active grid grid-cols-2 gap-4">
            <div class="bg-white p-6 rounded-xl shadow text-center">üì¶ S·∫£n ph·∫©m</div>
            <div class="bg-white p-6 rounded-xl shadow text-center">üè¨ Kho</div>
            <div class="bg-white p-6 rounded-xl shadow text-center">üè¢ C√¥ng ty</div>
            <div class="bg-white p-6 rounded-xl shadow text-center">üîë ƒêƒÉng nh·∫≠p</div>
        </div>

        <div id="tab-nhap" class="tab-content">
            <button onclick="openForm('nhap')" class="w-full bg-blue-600 text-white py-3 rounded-lg mb-4">+ PHI·∫æU NH·∫¨P M·ªöI</button>
            <div id="list-nhap" class="space-y-3"></div>
        </div>
        <div id="tab-xuat" class="tab-content">
            <button onclick="openForm('xuat')" class="w-full bg-red-600 text-white py-3 rounded-lg mb-4">+ PHI·∫æU XU·∫§T M·ªöI</button>
            <div id="list-xuat" class="space-y-3"></div>
        </div>

        <div id="tab-baocao" class="tab-content bg-white p-4 rounded-xl shadow">
            <h2 class="font-bold mb-4">B√ÅO C√ÅO T·ªíN KHO</h2>
            <div class="space-y-2 mb-4">
                <input type="date" id="rep-from" class="w-full border p-2 rounded">
                <input type="date" id="rep-to" class="w-full border p-2 rounded">
                <button onclick="runReport()" class="w-full bg-green-600 text-white py-2 rounded">XEM B√ÅO C√ÅO</button>
            </div>
            <div id="report-res" class="text-sm"></div>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbwyOm-7TspR9Lpe5dNQ5BuQgjEqDePeHBFkW4KfPFlzopL_ozZ0lPjK7UzxxsBGuueo/exec"; 
        let db = JSON.parse(localStorage.getItem('kho_cache')) || { transactions: [], details: [], products: [] };

        async function sync() {
            const r = await fetch(API);
            db = await r.json();
            localStorage.setItem('kho_cache', JSON.stringify(db));
            renderList('nhap'); renderList('xuat');
        }

        function showTab(t) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('active-nav'));
            document.getElementById('tab-' + t).classList.add('active');
            document.getElementById('btn-' + t).classList.add('active-nav');
        }

        function renderList(type) {
            const container = document.getElementById('list-' + type);
            container.innerHTML = '';
            const filtered = db.transactions.filter(t => t.Loai === type).sort((a,b) => new Date(b.Ngay) - new Date(a.Ngay));
            
            filtered.forEach(t => {
                const items = db.details.filter(d => d.ParentID == t.ID);
                const sumKg = items.reduce((s, i) => s + Number(i.TongKg), 0);
                container.innerHTML += `
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 ${type==='nhap'?'border-blue-500':'border-red-500'}">
                        <div class="flex justify-between text-xs text-gray-500"><span>${t.Ngay}</span><span>${t.Kho}</span></div>
                        <div class="font-bold text-gray-800">${t.CongTy}</div>
                        <div class="text-sm text-gray-600">T·ªïng: ${sumKg.toLocaleString()} Kg | Hƒê: ${t.HopDong}</div>
                    </div>`;
            });
        }

        function runReport() {
            const out = document.getElementById('report-res');
            out.innerHTML = "ƒêang t√≠nh to√°n...";
            // Logic l·ªçc theo ng√†y v√† m√£ s·∫£n ph·∫©m t·∫°i ƒë√¢y
            // C√¥ng th·ª©c: Kg = (Ki·ªán * Quy c√°ch + T√∫i l·∫ª) * Net
        }

        window.onload = sync;
    </script>
</body>
</html>
